# Automatically activate uv virtual environment when entering this directory
if ! [ -d .venv ]; then
    echo "Creating virtual environment with uv..."
    uv venv --python 3.10
fi

source .venv/bin/activate

# Sync dependencies from pyproject.toml
if [ -f pyproject.toml ]; then
    uv sync --no-install-project || uv sync
fi

# Install packages that require custom indexes (if not already installed)
if ! python -c "import torch" 2>/dev/null; then
    echo "Installing PyTorch with CUDA support..."
    uv pip install torch==2.2.0 torchvision==0.17.0 torchaudio==2.2.0 --index-url https://download.pytorch.org/whl/cu121
fi

if ! python -c "import bpy" 2>/dev/null; then
    echo "Installing bpy from Blender's PyPI..."
    uv pip install bpy==4.0.0 --extra-index-url https://download.blender.org/pypi/
fi

if ! python -c "import pytorch3d" 2>/dev/null; then
    echo "Installing PyTorch3D from GitHub..."
    uv pip install "git+https://github.com/facebookresearch/pytorch3d.git" --no-build-isolation
fi
